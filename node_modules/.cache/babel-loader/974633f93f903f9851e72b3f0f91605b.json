{"remainingRequest":"/Users/xxk/Desktop/mall/node_modules/.8.0.6@babel-loader/lib/index.js!/Users/xxk/Desktop/mall/node_modules/.2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/xxk/Desktop/mall/node_modules/.15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/xxk/Desktop/mall/src/views/Cart.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xxk/Desktop/mall/src/views/Cart.vue","mtime":1560331678000},{"path":"/Users/xxk/Desktop/mall/node_modules/.2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xxk/Desktop/mall/node_modules/.8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/xxk/Desktop/mall/node_modules/.2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xxk/Desktop/mall/node_modules/.15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"/Users/xxk/Desktop/mall/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/checkbox/style\";\nimport _Checkbox from \"vant/es/checkbox\";\nimport \"core-js/modules/es6.function.name\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\n\nvar _components;\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport TheFooter from 'components/TheFooter.vue';\nimport TheTitle from 'components/TheTitle.vue';\nimport Order from \"../api/order\";\nimport Cart from \"../api/cart\";\nexport default {\n  components: (_components = {\n    TheFooter: TheFooter,\n    TheTitle: TheTitle\n  }, _defineProperty(_components, _PullRefresh.name, _PullRefresh), _defineProperty(_components, _Checkbox.name, _Checkbox), _defineProperty(_components, _Toast.name, _Toast), _components),\n  data: function data() {\n    return {\n      cartList: [],\n      isLoading: false,\n      loading: false,\n      finished: false,\n      checkAll: false,\n      totalPrice: 0,\n      checkoutList: [],\n      orderCheckoutList: {\n        DealNumber: [],\n        CommodityCode: [],\n        CommodityName: [],\n        DealSum: [],\n        SupplyMoney: []\n      }\n    };\n  },\n  created: function created() {\n    this.getCartList();\n  },\n  watch: {\n    cartList: {\n      deep: true,\n      handler: function handler(val) {\n        var _this = this;\n\n        var price = 0;\n        this.checkoutList = [];\n        val.forEach(function (list, index, arr) {\n          if (list.checked) {\n            console.log(list);\n\n            _this.checkoutList.push(list); // this.orderCheckoutList.DealNumber = list.listObj[0].DealNumber\n            // this.orderCheckoutList.DealNumber.push(list.listObj[0].DealNumber)\n            // this.orderCheckoutList.CommodityCode.push(list.listObj[0].CommodityCode)\n            // this.orderCheckoutList.CommodityName.push(list.listObj[0].CommodityName)\n            // this.orderCheckoutList.DealSum.push(list.listObj[0].DealSum)\n            // this.orderCheckoutList.SupplyMoney.push(list.listObj[0].SupplyMoney)\n            // console.log(this.orderCheckoutList)\n\n\n            sessionStorage.setItem('checkout', JSON.stringify(_this.checkoutList));\n            price += list.listObj[0].DealSum * list.listObj[0].SupplyMoney;\n          }\n\n          if (arr[index].checked === true) {\n            _this.checkAll = true;\n          } else if (arr[index].checked === false) {\n            _this.checkAll = false;\n          }\n        });\n        this.totalPrice = price;\n      }\n    }\n  },\n  // beforeRouteEnter (to, from, next) {\n  //     if(from.name){\n  //         Cart.CartInfo({\n  //         }).then()\n  //     }  \n  // },\n  methods: {\n    getCartList: function getCartList() {\n      var _this2 = this;\n\n      Order.UserOrderTable({\n        \"SOURCE\": \"TEST\",\n        \"CREDENTIALS\": \"0\",\n        \"ADDRESS\": \"192.168.1.195\",\n        \"TERMINAL\": \"0\",\n        \"INDEX\": \"20170714\",\n        \"METHOD\": \"UserOrderTable\",\n        \"UserAccount\": \"test001\",\n        \"Num\": \"10\",\n        \"Sum\": \"1\",\n        \"Status\": \"0\"\n      }).then(function (res) {\n        if (res.DATA) {\n          _this2.setCartList(res);\n        } // this.cartList = res.DATA.map(item => this.$set(item, 'select', true))\n\n      });\n    },\n    setCartList: function setCartList(res) {\n      var list = res.DATA;\n\n      for (var i = 0; i < list.length; i++) {\n        var _this$cartList$push;\n\n        var listData = list[i].CommodityCode[0];\n        var listArr = [];\n\n        for (var j = 0; j < listData.CommodityCode.length; j++) {\n          listArr.push({\n            CommodityCode: listData.CommodityCode[j],\n            CommodityName: listData.CommodityName[j],\n            ConfirmTime: listData.ConfirmTime[j],\n            DealMoney: listData.DealMoney[j],\n            DealNumber: listData.DealNumber[j],\n            DealStatus: listData.DealStatus[j],\n            DealSum: parseInt(listData.DealSum[j]),\n            DetailedAddress: listData.DetailedAddress[j],\n            FilePath: listData.FilePath[j].split(',')[0] + listData.FilePath[j].split(',')[1],\n            SupplyMoney: listData.SupplyMoney[j],\n            UserAccount: listData.UserAccount[j]\n          });\n        }\n\n        this.cartList.push((_this$cartList$push = {\n          ConfirmTime: list[i].ConfirmTime,\n          DealMoney: list[i].DealMoney,\n          DealNumber: list[i].DealNumber\n        }, _defineProperty(_this$cartList$push, \"ConfirmTime\", list[i].ConfirmTime), _defineProperty(_this$cartList$push, \"DealStatus\", list[i].DealStatus), _defineProperty(_this$cartList$push, \"checked\", false), _defineProperty(_this$cartList$push, \"listObj\", listArr), _this$cartList$push)); // this.num = parseInt(this.cartList[i].listObj[0].DealSum)\n      }\n\n      console.log(this.cartList);\n    },\n    onCheckAll: function onCheckAll() {\n      if (this.checkAll) {\n        this.checkAll = true;\n        this.cartList.forEach(function (item) {\n          item.checked = true;\n        });\n      } else {\n        this.checkAll = false;\n        this.cartList.forEach(function (item) {\n          item.checked = false;\n        });\n      }\n    },\n    changeCart: function changeCart(val) {},\n    toDetail: function toDetail() {\n      this.$router.push('./detail');\n    },\n    cartEdit: function cartEdit(list, num) {\n      var item = list.listObj[0];\n      if (num < 0 && num === 1) return; // if(num > 0 && list.num == list.listObj[0].DealSum) return\n\n      var consumption = num > 0 ? 0 : 1;\n      var DealNumber = num > 0 ? 0 : item.DealNumber;\n      var postData = '[[\"DealNumber\",\"CommodityCode\",\"CommodityName\",\"Num\",\"SupplyMoney\"],[\"' + DealNumber + '\",\"' + item.CommodityCode + '\",\"' + item.CommodityName + '\",\"1\",\"' + item.SupplyMoney + '\"]]';\n      Cart.CartManage({\n        \"SOURCE\": \"TEST\",\n        \"CREDENTIALS\": \"0\",\n        \"ADDRESS\": \"192.168.1.195\",\n        \"TERMINAL\": \"0\",\n        \"INDEX\": \"20170714\",\n        \"METHOD\": \"CartManage\",\n        \"UserAccount\": \"test001\",\n        \"DATA\": encodeURI(postData),\n        \"Status\": consumption.toString()\n      }).then(function (res) {\n        if (res.DATA) {\n          if (res.DATA[0]) {\n            // this.num += num\n            item.DealSum += num;\n          }\n        }\n      });\n    },\n    deleteCart: function deleteCart() {\n      var _this3 = this;\n\n      this.cartList.forEach(function (list) {\n        if (list.checked === true) {\n          _this3.orderCheckoutList.DealNumber.push(list.listObj[0].DealNumber);\n\n          _this3.orderCheckoutList.CommodityCode.push(list.listObj[0].CommodityCode);\n\n          _this3.orderCheckoutList.CommodityName.push(list.listObj[0].CommodityName);\n\n          _this3.orderCheckoutList.DealSum.push(list.listObj[0].DealSum);\n\n          _this3.orderCheckoutList.SupplyMoney.push(list.listObj[0].SupplyMoney);\n        }\n      });\n      console.log(this.orderCheckoutList);\n      var postData = '[[\"DealNumber\",\"CommodityCode\",\"CommodityName\",\"Num\",\"SupplyMoney\"],[\"' + this.orderCheckoutList.DealNumber + '\",\"' + this.orderCheckoutList.CommodityCode + '\",\"' + this.orderCheckoutList.CommodityName + '\",\"' + this.orderCheckoutList.DealSum + '\",\"' + this.orderCheckoutList.SupplyMoney + '\"]]';\n\n      if (this.orderCheckoutList.CommodityName.length === 0) {\n        _Toast('请选择要删除的商品');\n      } else {// Cart.DeleteCart({\n        //     \"SOURCE\": \"TEST\",\n        //     \"CREDENTIALS\": \"0\",\n        //     \"ADDRESS\": \"192.168.1.195\",\n        //     \"TERMINAL\": \"0\",\n        //     \"INDEX\": \"20170714\",\n        //     \"METHOD\": \"DeleteCart\",\n        //     \"UserAccount\": \"test001\",\n        //     \"DATA\": encodeURI(postData),\n        //     \"Status\": \"1\"\n        // }).then(res => {\n        //     console.log(res)\n        // })\n      }\n\n      console.log(postData);\n    },\n    toOrderCheckout: function toOrderCheckout() {\n      console.log(this.checkoutList);\n      this.totalPrice === 0 ? _Toast('请选择要结算的商品') : this.$router.push({\n        name: 'OrderCheckout',\n        query: {\n          totalPrice: this.totalPrice\n        }\n      });\n    },\n    onRefresh: function onRefresh() {\n      var _this4 = this;\n\n      setTimeout(function () {\n        _this4.$toast('刷新成功');\n\n        _this4.isLoading = false;\n      }, 500);\n    },\n    onLoad: function onLoad() {\n      // 异步更新数据\n      setTimeout(function () {// for (let i = 0; i < 10; i++) {\n        //     this.list.push(this.list.length + 1);\n        // }\n        // // 加载状态结束\n        // this.loading = false;\n        // // 数据全部加载完成\n        // if (this.list.length >= 40) {\n        //     this.finished = true;\n        // }\n      }, 500);\n    }\n  },\n  mounted: function mounted() {}\n};",{"version":3,"sources":["Cart.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div class=\"layout\">\r\n        <header>\r\n            <div class=\"title\">\r\n                <span>购物车</span>\r\n                <img @click=\"deleteCart\" class=\"delete\" src=\"../assets/images/search/search-ic-delete@3x.png\" alt=\"\">\r\n            </div>\r\n        </header>\r\n        <!-- <the-title title=\"购物车\"></the-title> -->\r\n        <div class=\"cart-list\">\r\n            <div class=\"tips\">\r\n                <div class=\"tips-left\">\r\n                    <img src=\"../assets/images/home/home_ic_notice@3x.png\" alt=\"\">\r\n                    <span>自营商品单笔订单金额满88元可免邮费</span>\r\n                </div>\r\n                <div class=\"tips-right\">\r\n                    <img src=\"../assets/images/cart/shoppingcart_ic_Jump_r@3x.png\" alt=\"\">\r\n                </div>\r\n            </div>\r\n            <div v-if=\"cartList&&cartList.length>0\">\r\n            <van-pull-refresh v-model=\"isLoading\" @refresh=\"onRefresh\">\r\n                <!-- <van-list\r\n                    v-model=\"loading\"\r\n                    :finished=\"finished\"\r\n                    finished-text=\"没有更多了\"\r\n                    @load=\"onLoad\"\r\n                > -->\r\n                <ul>\r\n                    <li v-for=\"(list, index) in cartList\" :key=\"list.DealNumber\" class=\"item\">\r\n                    <!-- <li class=\"item\"> -->\r\n                        <div class=\"ui-flex align-center justify-center\">\r\n                            <div class=\"choose\">\r\n                                <van-checkbox v-model=\"list.checked\" @click=\"changeCart(list, index)\" checked-color=\"#ff3948\"></van-checkbox>\r\n                                <!-- <img class=\"selected\" src=\"../assets/images/cart/ic_check_air@3x.png\" alt=\"\"> -->\r\n                            </div>\r\n                            <div class=\"img-product\" @click=\"toDetail\"><img v-lazy=\"list.listObj[0].FilePath\" alt=\"\"></div>\r\n                            <div class=\"info\">\r\n                                <p class=\"name\">{{list.listObj[0].CommodityName}}</p>\r\n                                <p class=\"option\">黑色</p>\r\n                                <div class=\"info-bottom\">\r\n                                    <p class=\"price\">￥{{list.listObj[0].SupplyMoney}}</p>\r\n                                    <div class=\"num flex\">\r\n                                        <img class=\"input-sub\" @click=\"cartEdit(list, -1)\" src=\"../assets/images/cart/shoppingcart_ic_less@3x.png\" alt=\"\">\r\n                                        <div class=\"input-num\">\r\n                                            <span>{{list.listObj[0].DealSum}}</span>\r\n                                        </div>\r\n                                        <img class=\"input-add\" @click=\"cartEdit(list, 1)\" src=\"../assets/images/cart/shoppingcart_ic_plus@3x.png\" alt=\"\">\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n                <!-- </van-list> -->\r\n            </van-pull-refresh>\r\n            </div>\r\n            <div v-else class=\"empty\">\r\n                <img src=\"../assets/images/empty/default_empty_shopping_cart@3x.png\" alt=\"\">\r\n                <p>购物车还是空的，去挑选商品吧...</p>\r\n            </div>\r\n        </div>\r\n        <div class=\"bottom-submit box-flex\">\r\n            <div class=\"check\">\r\n                <van-checkbox class=\"selected\" @click=\"onCheckAll\" v-model=\"checkAll\" checked-color=\"#ff3948\"></van-checkbox>\r\n                <!-- <img class=\"selected\" src=\"../assets/images/cart/ic_check_air@3x.png\" alt=\"\"> -->\r\n                <span>全选</span>\r\n            </div>\r\n            <div class=\"price-box\">\r\n                <span>合计:<span class=\"total-price\">￥{{totalPrice}}</span></span>\r\n                <button @click=\"toOrderCheckout\">结算</button>\r\n            </div>\r\n            \r\n        </div>\r\n        <the-footer />\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport TheFooter from 'components/TheFooter.vue'\r\nimport TheTitle from 'components/TheTitle.vue'\r\nimport { PullRefresh, Checkbox, Toast } from 'vant'\r\nimport Order from '../api/order'\r\nimport Cart from '../api/cart'\r\n\r\nexport default {\r\n    components: {\r\n        TheFooter,\r\n        TheTitle,\r\n        [PullRefresh.name]: PullRefresh,\r\n        [Checkbox.name]: Checkbox,\r\n        [Toast.name]: Toast\r\n    },\r\n    data(){\r\n        return {\r\n            cartList: [],\r\n            isLoading: false,\r\n            loading: false,\r\n            finished: false,\r\n            checkAll: false,\r\n            totalPrice: 0,\r\n            checkoutList: [],\r\n            orderCheckoutList: {\r\n                DealNumber: [],\r\n                CommodityCode: [],\r\n                CommodityName: [],\r\n                DealSum: [],\r\n                SupplyMoney: [],\r\n            },\r\n        }\r\n    },\r\n    created(){\r\n        this.getCartList()\r\n    },\r\n    watch: {\r\n        cartList: {\r\n            deep: true,\r\n            handler (val){\r\n                let price = 0\r\n                this.checkoutList = []\r\n                val.forEach((list, index, arr) => {\r\n                    if(list.checked){\r\n                        console.log(list)\r\n                        this.checkoutList.push(list)\r\n                        // this.orderCheckoutList.DealNumber = list.listObj[0].DealNumber\r\n                        // this.orderCheckoutList.DealNumber.push(list.listObj[0].DealNumber)\r\n                        // this.orderCheckoutList.CommodityCode.push(list.listObj[0].CommodityCode)\r\n                        // this.orderCheckoutList.CommodityName.push(list.listObj[0].CommodityName)\r\n                        // this.orderCheckoutList.DealSum.push(list.listObj[0].DealSum)\r\n                        // this.orderCheckoutList.SupplyMoney.push(list.listObj[0].SupplyMoney)\r\n                        // console.log(this.orderCheckoutList)\r\n                        sessionStorage.setItem('checkout', JSON.stringify(this.checkoutList))\r\n                        price += list.listObj[0].DealSum * list.listObj[0].SupplyMoney\r\n                    }\r\n                    if(arr[index].checked === true){\r\n                        this.checkAll = true\r\n                    }else if(arr[index].checked === false){\r\n                        this.checkAll = false\r\n                    }\r\n                })\r\n                this.totalPrice = price\r\n            }\r\n        }\r\n    },\r\n    // beforeRouteEnter (to, from, next) {\r\n    //     if(from.name){\r\n    //         Cart.CartInfo({\r\n\r\n    //         }).then()\r\n    //     }  \r\n    // },\r\n    methods: {\r\n        getCartList(){\r\n            Order.UserOrderTable({\r\n                \"SOURCE\": \"TEST\",\r\n                \"CREDENTIALS\": \"0\",\r\n                \"ADDRESS\": \"192.168.1.195\",\r\n                \"TERMINAL\": \"0\",\r\n                \"INDEX\": \"20170714\",\r\n                \"METHOD\": \"UserOrderTable\",\r\n                \"UserAccount\": \"test001\",\r\n                \"Num\": \"10\",\r\n                \"Sum\": \"1\",\r\n                \"Status\": \"0\"\r\n            }).then(res => {\r\n                if(res.DATA){\r\n                    this.setCartList(res)\r\n                }\r\n                // this.cartList = res.DATA.map(item => this.$set(item, 'select', true))\r\n            })\r\n        },\r\n        setCartList(res){\r\n            let list = res.DATA\r\n            for(let i = 0; i<list.length; i++){\r\n                let listData = list[i].CommodityCode[0]\r\n                let listArr = []\r\n                for(let j=0; j<listData.CommodityCode.length; j++){\r\n                    listArr.push({\r\n                        CommodityCode: listData.CommodityCode[j],\r\n                        CommodityName: listData.CommodityName[j],\r\n                        ConfirmTime: listData.ConfirmTime[j],\r\n                        DealMoney: listData.DealMoney[j],\r\n                        DealNumber: listData.DealNumber[j],\r\n                        DealStatus: listData.DealStatus[j],\r\n                        DealSum: parseInt(listData.DealSum[j]),\r\n                        DetailedAddress: listData.DetailedAddress[j],\r\n                        FilePath: listData.FilePath[j].split(',')[0]+listData.FilePath[j].split(',')[1],\r\n                        SupplyMoney: listData.SupplyMoney[j],\r\n                        UserAccount: listData.UserAccount[j]\r\n                    })\r\n                }\r\n                this.cartList.push({\r\n                    ConfirmTime: list[i].ConfirmTime,\r\n                    DealMoney: list[i].DealMoney,\r\n                    DealNumber: list[i].DealNumber,\r\n                    ConfirmTime: list[i].ConfirmTime,\r\n                    DealStatus: list[i].DealStatus,\r\n                    checked: false, // 添加复选框状态\r\n                    listObj: listArr\r\n                })\r\n                // this.num = parseInt(this.cartList[i].listObj[0].DealSum)\r\n            }\r\n            console.log(this.cartList)\r\n        },\r\n        onCheckAll(){\r\n            if(this.checkAll){\r\n                this.checkAll = true\r\n                this.cartList.forEach(item => {\r\n                    item.checked = true\r\n                })\r\n            }else{\r\n                this.checkAll = false\r\n                this.cartList.forEach(item => {\r\n                    item.checked = false\r\n                })\r\n            }\r\n        },\r\n        changeCart(val){\r\n            \r\n        },\r\n        toDetail(){\r\n            this.$router.push('./detail')\r\n        },\r\n        cartEdit(list, num){\r\n            let item = list.listObj[0]\r\n            if(num < 0 && num === 1) return\r\n            // if(num > 0 && list.num == list.listObj[0].DealSum) return\r\n            let consumption = num > 0 ? 0 : 1\r\n            let DealNumber = num > 0 ? 0 : item.DealNumber\r\n            let postData = '[[\"DealNumber\",\"CommodityCode\",\"CommodityName\",\"Num\",\"SupplyMoney\"],[\"'+DealNumber+'\",\"'+item.CommodityCode+'\",\"'+item.CommodityName+'\",\"1\",\"'+item.SupplyMoney+'\"]]'\r\n            Cart.CartManage({\r\n                \"SOURCE\": \"TEST\",\r\n                \"CREDENTIALS\": \"0\",\r\n                \"ADDRESS\": \"192.168.1.195\",\r\n                \"TERMINAL\": \"0\",\r\n                \"INDEX\": \"20170714\",\r\n                \"METHOD\": \"CartManage\",\r\n                \"UserAccount\": \"test001\",\r\n                \"DATA\": encodeURI(postData),\r\n                \"Status\": consumption.toString()\r\n            }).then(res => {\r\n                if(res.DATA){\r\n                    if(res.DATA[0]){\r\n                        // this.num += num\r\n                        item.DealSum += num\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        deleteCart(){\r\n            this.cartList.forEach(list => {\r\n                if(list.checked === true){\r\n                    this.orderCheckoutList.DealNumber.push(list.listObj[0].DealNumber)\r\n                    this.orderCheckoutList.CommodityCode.push(list.listObj[0].CommodityCode)\r\n                    this.orderCheckoutList.CommodityName.push(list.listObj[0].CommodityName)\r\n                    this.orderCheckoutList.DealSum.push(list.listObj[0].DealSum)\r\n                    this.orderCheckoutList.SupplyMoney.push(list.listObj[0].SupplyMoney)\r\n                }\r\n            })\r\n            console.log(this.orderCheckoutList)\r\n            let postData = '[[\"DealNumber\",\"CommodityCode\",\"CommodityName\",\"Num\",\"SupplyMoney\"],[\"'+this.orderCheckoutList.DealNumber+'\",\"'+this.orderCheckoutList.CommodityCode+'\",\"'+this.orderCheckoutList.CommodityName+'\",\"'+this.orderCheckoutList.DealSum+'\",\"'+this.orderCheckoutList.SupplyMoney+'\"]]'\r\n            if(this.orderCheckoutList.CommodityName.length === 0){\r\n                Toast('请选择要删除的商品')\r\n            }else{\r\n                // Cart.DeleteCart({\r\n                //     \"SOURCE\": \"TEST\",\r\n                //     \"CREDENTIALS\": \"0\",\r\n                //     \"ADDRESS\": \"192.168.1.195\",\r\n                //     \"TERMINAL\": \"0\",\r\n                //     \"INDEX\": \"20170714\",\r\n                //     \"METHOD\": \"DeleteCart\",\r\n                //     \"UserAccount\": \"test001\",\r\n                //     \"DATA\": encodeURI(postData),\r\n                //     \"Status\": \"1\"\r\n                // }).then(res => {\r\n                //     console.log(res)\r\n                // })\r\n            }\r\n            console.log(postData)\r\n        },\r\n        toOrderCheckout(){\r\n            console.log(this.checkoutList)\r\n            this.totalPrice === 0 ? Toast('请选择要结算的商品') : this.$router.push({name: 'OrderCheckout', query: {totalPrice: this.totalPrice}})\r\n        },\r\n        onRefresh() {\r\n            setTimeout(() => {\r\n                this.$toast('刷新成功')\r\n                this.isLoading = false\r\n            }, 500);\r\n        },\r\n        onLoad() {\r\n            // 异步更新数据\r\n            setTimeout(() => {\r\n                // for (let i = 0; i < 10; i++) {\r\n                //     this.list.push(this.list.length + 1);\r\n                // }\r\n                // // 加载状态结束\r\n                // this.loading = false;\r\n\r\n                // // 数据全部加载完成\r\n                // if (this.list.length >= 40) {\r\n                //     this.finished = true;\r\n                // }\r\n            }, 500);\r\n        }\r\n    },\r\n    mounted(){\r\n\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n    .layout{\r\n        height 100vh\r\n        background #eee\r\n    }\r\n    .flex{\r\n        display flex\r\n        justify-content space-around\r\n        align-items  center\r\n    }\r\n    .title{\r\n        position fixed\r\n        top 0\r\n        left 0\r\n        right 0\r\n        height 50px\r\n        line-height 50px\r\n        padding 0 14px\r\n        background #fff\r\n        font-size 18px\r\n        color #000\r\n        font-weight bold\r\n        letter-spacing 2px\r\n        z-index 10\r\n        .delete{\r\n            position absolute\r\n            right 10px\r\n            top 50%\r\n            transform translateY(-50%)\r\n            width 16px\r\n        }\r\n        &:after{\r\n            display block\r\n            content ''\r\n            clear both\r\n        }\r\n    }\r\n    .cart-list{\r\n        background #eee\r\n        padding-top 50px\r\n        padding-bottom 100px\r\n        .tips{\r\n            display flex\r\n            justify-content space-between\r\n            align-items center\r\n            padding 10px\r\n            background #ffd9cd\r\n            font-size 13px\r\n            color #ff3948\r\n            .tips-left{\r\n                display flex\r\n                align-items center\r\n                img{\r\n                    width 20px\r\n                    margin-right 10px\r\n                }\r\n            }\r\n            .tips-right{\r\n                font-size 0\r\n                img{\r\n                    width 10px\r\n                }\r\n            }\r\n        }\r\n        .item{\r\n            margin 10px\r\n            padding 10px 8px\r\n            background #fff\r\n            border-radius 5px\r\n            .align-center{\r\n                display flex\r\n                .choose{\r\n                    display flex\r\n                    align-items center\r\n                    font-size 0\r\n                    img{\r\n                        margin-right 0\r\n                    }\r\n                }\r\n                .img-product{\r\n                    font-size 0\r\n                    margin 0 8px\r\n                    img{\r\n                        width 110px\r\n                        height 110px\r\n                    }\r\n                }\r\n                .info{\r\n                    position relative\r\n                    width 100%\r\n                    text-align left \r\n                    .option{\r\n                        margin-top 10px\r\n                        font-size 14px\r\n                        color #ccc\r\n                    }\r\n                    .info-bottom{\r\n                        position absolute\r\n                        bottom 0\r\n                        left 0\r\n                        right 0\r\n                        display flex\r\n                        justify-content space-between\r\n                        align-items  center\r\n                        // text-align bottom\r\n                        .price{\r\n                            color #ff3948\r\n                        }\r\n                        .num{\r\n                            // float right \r\n                            img{\r\n                                width 22px\r\n                            }\r\n                            .input-num{\r\n                                vertical-align middle\r\n                                min-width 30px\r\n                                padding 0 6px\r\n                                text-align center\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }\r\n        .empty{\r\n            position absolute\r\n            top 25%\r\n            img{\r\n                width 50%\r\n            }\r\n        }\r\n    }\r\n    .box-flex{\r\n        display flex\r\n        justify-content space-between\r\n        align-items center\r\n    }\r\n    .bottom-submit{\r\n        position fixed\r\n        bottom 50px\r\n        left 0\r\n        right 0\r\n        height 50px\r\n        background #fff\r\n        padding 0 10px\r\n        font-size 16px\r\n        color #000\r\n        .check{\r\n            display flex\r\n            align-items center\r\n            span{\r\n                color #939393\r\n            }\r\n        }\r\n        .price-box{\r\n            .total-price{\r\n                padding-left 8px\r\n                color #ff3948\r\n            }\r\n        }\r\n        button{\r\n            height 34px\r\n            padding 0 40px\r\n            margin-left 10px\r\n            border none \r\n            border-radius 20px\r\n            background #ff3948\r\n            color #fff\r\n        }\r\n    }\r\n    .selected{\r\n        width 20px\r\n        vertical-align middle\r\n        margin-right 10px\r\n    }\r\n</style>\r\n\r\n"],"sourceRoot":"src/views"}]}